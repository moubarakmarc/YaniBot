@startuml

!define RECTANGLE rectangle
skinparam rectangle {
    BackgroundColor #F9F9F9
    BorderColor #333
}

RECTANGLE AutomationManager {
}

AutomationManager --> init
AutomationManager --> automationLoop
AutomationManager --> performCycle
AutomationManager --> pickAndPlace

' ----------------------
' Init Flow
' ----------------------
init --> createBinManager
createBinManager : robotManager.scene
createBinManager --> setDefaults
setDefaults : cycleCount
setDefaults : cycleDelay
setDefaults : automationInterval
setDefaults : strategy
setDefaults : sourceBin
setDefaults : targetBin
setDefaults : stepAutomation
setDefaults : positions
setDefaults --> getPresetPositions
getPresetPositions --> logInit
logInit : "Automation Manager initialized"

' ----------------------
' AutomationLoop Flow
' ----------------------
automationLoop --> getStateFromAPI
getStateFromAPI --> "isStopped?"
"isStopped?" --> "exitLoop : Yes"
"isStopped?" --> "performCycleCall : No"
performCycleCall --> performCycleReturn
performCycleReturn --> "exitLoop : Yes"
performCycleReturn --> "sleepCycleDelay : No"
sleepCycleDelay --> updateStateFromAPI
updateStateFromAPI --> "isStopped?"

' ----------------------
' PerformCycle Flow
' ----------------------
performCycle --> incrementCycleCount
incrementCycleCount --> getTransferPair
getTransferPair --> setSourceTarget
setSourceTarget --> checkSourceBin
checkSourceBin --> "logNoTransfer : Yes"
logNoTransfer --> uiShowStatus
uiShowStatus --> uiHandleStop
uiHandleStop --> returnFalse
checkSourceBin --> "pickAndPlaceCall : No"
pickAndPlaceCall --> "uiExists?"
"uiExists?" --> "uiUpdateCycle : Yes"
uiUpdateCycle --> logCycleCompleted
logCycleCompleted --> returnTrue
"uiExists?" --> "logCycleCompleted : No"

' ----------------------
' PickAndPlace Flow
' ----------------------
pickAndPlace --> setPositions
setPositions : approachPos
setPositions : pickPos
setPositions : liftPos
setPositions : dropApproachPos
setPositions : dropPos
setPositions : dropLiftPos
setPositions --> moveIntermediate1
moveIntermediate1 --> moveApproach
moveApproach --> movePick
movePick --> robotPickObject
robotPickObject --> "uiExistsPick?"
"uiExistsPick?" --> "uiUpdateBinCountsPick : Yes"
uiUpdateBinCountsPick --> moveLift
"uiExistsPick?" --> "moveLift : No"
moveLift --> moveIntermediate2
moveIntermediate2 --> moveDropApproach
moveDropApproach --> moveDrop
moveDrop --> robotDropObject
robotDropObject --> "uiExistsDrop?"
"uiExistsDrop?" --> "uiUpdateBinCountsDrop : Yes"
"uiExistsDrop?" --> "moveDropLift : No"
uiUpdateBinCountsDrop --> moveDropLift
moveDropLift --> moveIntermediate3

@enduml
